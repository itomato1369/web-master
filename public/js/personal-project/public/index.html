<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>라디오 사연 모집!</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <!-- font awsome 사이트와 연결하여 아이콘 i태그 사용 -->
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <!-- 카카오(다음) 주소 API사용하기 위해 연결 -->
</head>
<body>
    <div class="container">
        <header>
            <img src="YedamLogo.png" alt="예담직업전문학교 로고" class="header-logo">
            <h1>라디오 사연 모집!</h1>
            <p class="subtitle"><i class="fa-solid fa-book"></i>  당신의 특별한 이야기를 들려주세요</p>
        </header>

        <section class="section story-lookup-area">
            <h2>내 사연 조회 및 수정</h2>
            <p class="section-desc">이름 혹은 닉네임과 비밀번호로 사연을 조회하고 수정할 수 있습니다!</p>
            
            <form action="/story_modify.html" method="get">
                <div class="form-group">
                    <label for="lookup-name-submit">이름 혹은 닉네임</label>
                    <input type="text" id="lookup-name-submit" name="lookup_name" placeholder="사연 작성 시 입력한 이름/닉네임">
                </div>
                <div class="form-group">
                    <label for="lookup-pw-submit">비밀번호</label>
                    <input type="password" id="lookup-pw-submit" name="lookup_pw"  placeholder="사연 작성 시 설정한 비밀번호">
                </div>
                
                <div class="submit-area">
                    <button type="submit" class="submit-button">사연 조회하기</button>
                </div>
            </form>
        </section>

        <form action="/submit-story" method="post" class="story-form" id="story-submit-form">
            <section class="section essential-info">
                <h2>사연자 정보</h2>
                <div class="form-group">
                    <label for="story_name">이름 혹은 닉네임</label>
                    <input type="text" id="story_name" name="story_name" placeholder="띄워쓰기 하지말고 입력해주세요">
                </div>
                
                <div class="form-group inline-unit">
                    <label for="story_age">나이</label>
                    <input type="text" id="story_age" name="story_age">  <label class="unit-label">세</label>
                </div>
                
                <div class="form-group">
                    <label>성별</label>
                    <div class="radio-group">
                        <div>
                            <input type="radio" id="gender_male" name="story_gender" value="남성">
                            <label for="gender_male">남성</label>
                        </div>

                        <div>
                            <input type="radio" id="gender_female" name="story_gender" value="여성">
                            <label for="gender_female">여성</label>
                        </div>

                        <div>
                            <input type="radio" id="gender_other_radio" name="story_gender" value="기타">
                            <label for="gender_other_radio">직접입력</label>
                        </div>
                    </div>
                        <input type="text" id="story_gender_other" name="story_gender_other" style="display:none; margin-top: 10px;" placeholder="직접 입력">
                </div>
            </section>
            
            <section class="section story-content-area">
                <h2>사연 작성</h2>
                <div class="form-group">
                    <label for="story_pw">사연 조회 및 수정을 위한 비밀번호 설정</label>
                    <input type="password" id="story_pw" name="story_pw" placeholder="4자리 이상, 영어 대/소문자 및 특수문자 포함">
                </div>

                <div class="form-group">
                    <label for="story_pw_confirm">비밀번호 확인</label>
                    <input type="password" id="story_pw_confirm" placeholder="확인을 위해 다시 입력해주세요.">
                </div>
                
                <div class="form-group">
                    <label for="story_content">사연을 작성해 주세요</label>
                    <textarea id="story_content" name="story_content" rows="10" placeholder="당신의 이야기를 들려주세요."></textarea>
                </div>
            </section>

            <section class="section prize-info-area">
                <h2><i class="fa-solid fa-gift"></i> 경품 응모 (선택 사항)</h2>
                <div class="form-group checkbox-group">
                    <input type="checkbox" id="gift_apply" name="gift_apply" value="Y">
                    <label for="gift_apply">경품 응모에 참여합니다</label>
                </div>
                
                <div id="prize_info_fields" style="display: none;">
                    <div class="form-group">
                        <label for="applicant_name">경품 수령인 이름(주민등록상 이름)</label>
                        <input type="text" id="applicant_name" name="applicant_name" placeholder="본명">
                    </div>

                    <div class="form-group">
                        <label for="applicant_email">이메일</label>
                        <input type="email" id="applicant_email" name="applicant_email" placeholder="경품 당첨 안내 이메일">
                    </div>

                    <div class="form-group">
                        <label for="applicant_phone">연락처</label>
                        <input type="tel" id="applicant_phone" name="applicant_phone" placeholder="010-1234-5678">
                    </div>
                    
                    <div class="form-group">
                        <label for="applicant_postal">경품 수령할 주소/우편번호</label>
                            <div class="address-group">
                                <div class="post-search-line">
                                    <input type="text" id="applicant_postal" name="applicant_postal" placeholder="00000" maxlength="5" readonly> <input type="button" onclick="execDaumPostcode()" value="우편번호 찾기" class="postcode-btn">
                                </div>
                                    <input type="text" id="address" placeholder="주소" readonly>
                            </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="address_detail">상세 주소</label>
                        <input type="text" id="address_detail" name="address_detail" placeholder="아파트 동/호수, 건물 이름 등">
                    </div>
                    
                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="privacy_agree" name="privacy_agree" value="Y">
                        <label for="privacy_agree">경품 응모를 위한 개인정보 수집 및 이용에 동의합니다</label>
                    </div>
            </div>
            </section>

            <div class="submit-area">
                <button type="submit" class="submit-button">사연 제출하기</button>
            </div>
        </form>
    </div>

   <footer>
        <div class="footer-content">
            <div class="footer-links">
                <a href="/terms_of_service.html">이용약관</a>
                <a href="/privacy_policy.html">개인정보처리방침</a>
                <a href="/about_us.html">회사 소개</a>
                <a href="/contact.html">문의하기</a>
            </div>
            
            <div class="social-media">
                <p>라디오 소식을 SNS에서도 만나보세요!</p>
                <div class="social-icons">
                    <a href="https://www.instagram.com/" target="instagram" title="인스타그램">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a href="https://www.youtube.com/" target="youtube" title="유튜브">
                        <i class="fab fa-youtube"></i>
                    </a>
                    <a href="https://x.com/i/flow/login" target="x" title="엑스">
                        <i class="fa-brands fa-x-twitter"></i>
                    </a>
                </div>
            </div>

            <div class="copyright">
                <p>라디오 사연 모집 이벤트</p>
                <p>&copy; 2025 RADIO EVENT FM. All Rights Reserved.
            </div>
        </div>
    </footer>
</body>

<script>
    function execDaumPostcode() {
    new daum.Postcode({
        // 주소 검색 팝업 객체를 만든다
        oncomplete: function(data) {
            // 콜백 함수(Callback Function)
            // 주소 검색 팝업에서 항목을 선택했을 때 실행될 코드입니다.
            // 주소 정보는 data 라는 변수에 담겨 함수로 전달

            var addr = ''; // 주소를 저장할 빈 문자열 addr 선언
            var extraAddr = ''; // 참고항목을 저장할 빈 문자열 extraAddr 선언

            // (1) 사용자가 선택한 주소 타입에 따라 해당 주소 값을 가져옵니다.
            if (data.userSelectedType === 'R') { 
                // 도로명 주소 선택 시 'R'
                addr = data.roadAddress;
            } else { 
                // 지번 주소 선택 시 'J'
                addr = data.jibunAddress;
            }

            // (2) 건물명이 있고, 아파트/빌라 등 공동주택인 경우 참고항목에 추가합니다.
            if(data.userSelectedType === 'R'){
                // 도로명 주소를 선택했을 때만
                // 법정동명이 있을 경우
                if(data.bname !== '' && /[동|로|가]$/g.test(data.bname)){
                    extraAddr += data.bname;
                }
                // 건물명 추가
                if(data.buildingName !== '' && data.apartment === 'Y'){
                    extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
                }
                // 표시할 참고항목이 있을 경우 괄호로 묶어 최종 주소 뒤에 추가합니다.
                if(extraAddr !== ''){
                    addr += ' (' + extraAddr + ')';
                }
            }

            // (3) 우편번호와 주소 정보를 해당 필드에 넣고, 상세주소 필드로 포커스를 이동시킵니다.
            document.getElementById('applicant_postal').value = data.zonecode; // 우편번호
            document.getElementById("address").value = addr; // 주소
            document.getElementById("address_detail").focus(); // 상세 주소 필드로 포커스 이동
            // 참고: 상세 주소는 사용자가 직접 입력해야 합니다.
        }
    }).open();
    // 주소 검색 팝업 창을 화면에 띄우는 명령
}

    // 성별-기타 선택 시 직접 입력 필드 토글 로직 (유지)
    const genderRadios = document.querySelectorAll('input[name="story_gender"]');
    // HTML문서에서 name이 story_gender인 모든 input태그를 찾아옴
    const genderOtherInput = document.getElementById('story_gender_other');

    function toggleGenderOtherInput() {
        const selectedGender = document.querySelector('input[name="story_gender"]:checked')?.value; 
        // 현재 사용자가 체크한 라디오 버튼의 값을 저장
        // name이 story_gender인 input태그중에서 체크된 버튼을 찾는다
        // ?.value 체크된 라디오 버튼이 없으면 오류를 내지 않으면서 undefined를 반환
        // 체크가 된다면 속성 값을 가져옴
        
        if (selectedGender === '기타') {
            genderOtherInput.style.display = 'block';
            // 선택한 버튼의 값이 '기타'와 같다면 (직접입력 버튼을 선택했다면)
            // display = 'block'; 보이게 
            genderOtherInput.setAttribute('required', 'required');
            // 반드시 입력
            genderOtherInput.value = ''; 
            // 이전에 입력했던 값 초기화
        } else {
            genderOtherInput.style.display = 'none';
            // 선택한 버튼이 직접입력이 아니라면
            // 숨김
            genderOtherInput.removeAttribute('required');
            // 필수입력 사항이 아님
        }
    }
    genderRadios.forEach(radio => {
        radio.addEventListener('change', toggleGenderOtherInput);
        // genderRadios에 반복 작업을 수행
        // 라디오 버튼을 선택할 때 마다 toogleGenderOtherInput 함수가 실행
    });
    
    // 경품 응모 로직
    const giftApplyCheckbox = document.getElementById('gift_apply');

    const prizeInfoSection = document.getElementById('prize_info_fields');

    function togglePrizeInfoSection() {
        const isChecked = giftApplyCheckbox.checked;
        prizeInfoSection.style.display = isChecked ? 'block' : 'none';
        // 경품 응모란에 체크가 되어있으면 'block' 아니면 'none'
        
        const requiredFields = prizeInfoSection.querySelectorAll(
            '#applicant_name, #applicant_email, #applicant_phone, #applicant_postal, #address_detail, #privacy_agree'
        );
        
        requiredFields.forEach(field => {
            if (isChecked) {
                field.setAttribute('required', 'required');
                // 경품 응모란에 체크했으면 위의 값을 다 입력해야 전송가능
            } else {
                field.removeAttribute('required');
            }
        });
    }
    togglePrizeInfoSection(); 
    giftApplyCheckbox.addEventListener('change', togglePrizeInfoSection);


    //  비밀번호 일치 확인 및 유효성 검사 로직 변수 선언
    const submitForm = document.getElementById('story-submit-form');
    // id가 story-submit-form인 요소를 가져온다 = 폼 전체

    const storyPwField = document.getElementById('story_pw');
    // 폼 전체 그 중에서 id가 story_pw인 애를 데리고 온다
    const storyPwConfirmField = document.getElementById('story_pw_confirm');
    // id 가 story_pw_confirm인 애를 데리고 온다

    submitForm.addEventListener('submit', function (event) {
        // 1. 비밀번호 일치 확인
        if (storyPwField.value !== storyPwConfirmField.value) {
            event.preventDefault(); // 폼 제출 방지
            alert('사연 비밀번호가 일치하지 않습니다. 다시 확인해 주세요.');
            storyPwConfirmField.focus();
            return;
        }

        // 2. 비밀번호 복잡성 확인 (서버 측 로직과 동일하게 유지)
        const pw = storyPwField.value;
        const hasUpperCase = /[A-Z]+/g;
        // /[A-Z]+/g; 정규 표현식 특정 문자열 패턴을 찾는데 사용
        // [A-Z] A부터 Z까지 대문자 중 하나
        // + 대문자가 한 개 이상 존재
        // g 전역 검색(Global)
        const hasLowerCase = /[a-z]+/g;
        const hasSpecialChar = /[!@#$%^&*]+/g;

        if (pw.length < 4 || !hasUpperCase.test(pw) || !hasLowerCase.test(pw) || !hasSpecialChar.test(pw)) {
            // !hasUpperCase.test(pw) 패턴이 pw 문자열에 포함되어 있지 않은지 대문자가
            event.preventDefault();
            alert('🚨 비밀번호는 4자리 이상이며, 대문자, 소문자, 특수문자(!@#$%^&*)를 포함해야 합니다.');
            storyPwField.focus();
            return;
        }
    });

</script>

</html>